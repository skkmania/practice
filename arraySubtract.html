<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">  
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="scriptaculous/test/test.css" type="text/css" />
  <link rel="stylesheet" href="cssSample.css" type="text/css" />
  <!-- other JavaScript includes -->
  <script src="scriptaculous/lib/prototype.js" type="text/javascript"></script>
  <script src="scriptaculous/src/unittest.js" type="text/javascript"></script>
  <script>
// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  return this.push.apply(this, rest);
};
// 上のものをapplyを使わずに書くとこんなふうになるか
Array.prototype.remove2 = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  for (var i = 0; i < rest.length; i++) this.push(rest[i]);
  return this;
};
Array.prototype.deleteAt = function(idx){
  var ret = [];
  for(var i = 0; i < this.length; i++){
    if(i != idx) ret.push(this[i]);
  }
  return ret;
};
Array.prototype.subtract = function(ary){
  // 配列から配列を引き算する
  $A(ary).each(function(c){
    var idx = $A(this).indexOf(c);
    if(idx >= 0) this.splice(idx,1);
  }.bind(this));
}

String.prototype.subtract = function(str){
  // 文字列から文字列を引き算する
  // 自分自身から与えられた文字列を引いた値を返す。
  // コピーを返すので元の値は変化しない
  var ret = $A(this);
  ret.subtract($A(str));
  return ret.join('');
}
String.prototype.subtract_old = function(str){
  // 文字列から文字列を引き算する
  // 自分自身から与えられた文字列を引いた値を返す。
  // コピーを返すので元の値は変化しない
  var extractor = $A(str);
  var ret = [];
  $A(this).inject(ret, function(array, c){
    var idx = extractor.indexOf(c);
    if(idx >= 0){
      extractor.splice(idx,1);
    } else
      array.push(c);
    return array;
  });
  return ret.join('');
};
String.prototype.subtractc = function(str){
  // 文字列から文字列を引き算する
  // 自分自身から与えられた文字列を引く。破壊的。
  var extractor = $A(str);
  var ret = [];
  $A(this).inject(ret, function(array, c){
    var idx = extractor.indexOf(c);
    if(idx >= 0){
      extractor = extractor.deleteAt(idx);
    } else
      array.push(c);
    return array;
  });
  return this = ret.join('');
  // と思ったが、thisへの代入は許されない。
};
var testcases = {
  setup : function()  {  with( this )  {
    // 領域を初期化
  } },
  teardown : function()  {  with( this )  {
    /* ..... テストの後処理(省略) ..... */
  } },
  testDeleteAt : function() {  with( this )  {
    // idxで指定した位置の要素を削除した配列のコピーを返す
    // 元の配列の内容は変らない
    var array = [1,2,3,4,5,6];
    try  {
      //new Event.simulateMouse( color, 'click' );
    }  catch( e )  {
      //buttonClick( { target : { id : color } } );
    }
    assert( '[1,2,3,5,6] == array.deleteAt(3)' );
    assert( '[1,2,4,5,6] == array.deleteAt(2)' );
  } },
  testRemove : function() {  with( this )  {
    // 指定した位置の要素を削除する。破壊的。
    var array2 = [1,2,3,4,5,6];
    array2.remove(3);
    assertEqual( [1,2,3,5,6].toString(), array2.toString());
    array2.remove(1,3);
    assertEqual( '1,6', array2.toString());
  } },
  testSplice : function() {  with( this )  {
    // 指定した位置の要素を破壊的に削除するのは標準でspliceがある。
    var array2 = [1,2,3,4,5,6];
    array2.splice(3,1);
    assertEqual( [1,2,3,5,6].toString(), array2.toString());
    array2.splice(1,3);
    assertEqual( '1,6', array2.toString());
  } },
  testRemove2 : function() {  with( this )  {
    // 指定した位置の要素を削除する。破壊的。
    var array2 = [1,2,3,4,5,6];
    array2.remove2(3);
    assertEqual( [1,2,3,5,6].toString(), array2.toString());
    array2.remove2(1,3);
    assertEqual( '1,6', array2.toString());
  } },
  testArraySubtract : function() {  with( this )  {
    // 配列の引き算。破壊的。
    var array = [0,1,2,3,4,5,6,7,8,9];
    var array2 = [1,2,3,4,5,6];
    array.subtract(array2);
    assertEqual( [0,7,8,9].toString(), array.toString());
    array.subtract([8,1,3]);
    assertEqual( '0,7,9', array.toString());
    array.subtract([0,7,9]);
    assertEqual( '', array.toString());
    array  = [0,1,2,2,2,3,3,4,5,6];
    array2 = [    2,2,  3,    5  ]
    array.subtract(array2);
    assertEqual( '0,1,2,3,4,6', array.toString());
  } },
  testSubtract : function() {  with( this )  {
    assertEqual( "abcd", "abcdefj".subtract("efj") );
    assertEqual( "bd", "abcdefj".subtract("acefj") );
    assertEqual( "acefj", "abcdefj".subtract("bd") );
    assertEqual( "", "abcdefj".subtract("abcdefj") );
    assertEqual( "abcdefj", "aaabcdefj".subtract("aa") );
    // 返されるのはコピーである
    var s = "abcdefj";
    var s2 = s.subtract("bej");
    assertEqual( "acdf", s2 );
    // 元のsは変化しない
    assertEqual( "abcdefj", s );
  } },
  testSubtractc : function() {  with( this )  {
    assertEqual( "abcd", "abcdefj".subtractc("efj") );
    assertEqual( "bd", "abcdefj".subtractc("acefj") );
    assertEqual( "acefj", "abcdefj".subtractc("bd") );
    assertEqual( "", "abcdefj".subtractc("abcdefj") );
    assertEqual( "abcdefj", "aaabcdefj".subtractc("aa") );
    // 返されるのはコピーではない
    var s = "abcdefj";
    var s2 = s.subtractc("bej");
    assertEqual( "acdf", s2 );
    // 元のsは変化した。
    assertEqual( "acdf", s );

  } }
};

    function init(){
      var elm = document.getElementById('val');
      var txt = document.createElement('text');
      var n = 4;
      var a = [1,2,3,4,5];
      txt.innerHTML = a.deleteAt(2).join('');
      elm.appendChild(txt);

      var s = "abcde";
      var elm2 = document.getElementById('val2');
      var txt2 = document.createElement('text');
      txt2.innerHTML = s.subtract("bcd");
      elm2.appendChild(txt2);

      new Test.Unit.Runner( testcases, 'testlog' );
    }
    window.onload = init;
  </script>
</head>
<body>
<div id="container">
  1, 2, 3,
  <div id = "val"></div>
  5, 6, 7
  <div id = "val2"></div>
</div>
<!-- Log output -->
<div>テスト結果の出力先</div>
<div id="testlog"></div>
</body>
</html>

